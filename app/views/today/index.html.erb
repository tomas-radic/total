<%= turbo_stream_from "matches" %>
<%= turbo_stream_from "players_open_to_play" %>

<div id="today_index_reload_notice"></div>

<section id="intro" class="px-4 py-8 md:px-8 base-green">
  <h2 class="page-heading text-right primary-color py-2 lg:text-center">
    Topoľčianska tenisová<br>amatérska liga.
  </h2>
  <div class="text-5xl text-left pt-8 lg:py-12 lg:text-center lg:text-7xl">
    <h1 class="p-2 bg-accent inline-block">TOtal.</h1>
  </div>
  <div class="underline default-color pt-6">
    <div class="py-1"><a href="#recent-matches">Posledné zápasy</a></div>
    <div class="py-1"><a href="#planned-matches">Zápasy na pláne</a></div>
    <div class="py-1"><a href="#race">Nominácie PLAY OFF</a></div>
  </div>
  <% if selected_season.present? %>
    <!-- Requested matches -->
    <% if @requested_matches.any? || @rejected_matches.any? %>
      <div class="text-right">
        <div class="inline-block">
          <h3 class="text-2xl primary-color pt-8 pb-2 md:text-4xl">
            Nepotvrdené výzvy
          </h3>
          <ul class="text-right md:text-center">
            <% @requested_matches.each do |match| %>
              <li>
                <%= link_to "#{match.side 1} vyzval/a #{match.side 2}",
                            match_path(match),
                            class: "underline text-sm px-2 py-1 md:text-lg #{policy(match).accept? || policy(match).destroy? ? 'font-extrabold bg-red-500 text-white' : 'default-color'}" %>
              </li>
            <% end %>
          </ul>
          <ul class="text-right md:text-center mt-4">
            <% @rejected_matches.each do |match| %>
              <li>
                  <%= link_to "#{match.side 2} odmietol/la zápas s #{match.side 1}",
                              match_path(match),
                              class: "underline text-sm text-gray-300 px-2 lg:text-lg" %>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    <% end %>

    <!-- Players open to play -->
    <div id="players_open_to_play_top" class="text-right">
      <%= render partial: "shared/players_open_to_play",
                 locals: { players: @players_open_to_play } %>
    </div>

  <% else %>
    <h3 class="text-right text-2xl primary-color pt-8 pb-2 md:text-4xl">
      Nie je sezóna. Všetci netrpezlivo čakáme.
    </h3>
  <% end %>

  <!-- Upcoming tournaments -->
  <% if selected_season && @upcoming_tournaments.any? %>
    <h3 class="text-2xl primary-color pt-8 pb-2 md:text-4xl">
      Najbližšie turnaje
    </h3>
    <% @upcoming_tournaments.each do |tournament| %>
      <%= render partial: "today/tournament", locals: { tournament: tournament } %>
    <% end %>
  <% end %>
</section>

<section id="recent-matches" class="base-yellow min-h-screen px-2 py-8 md:px-8">
  <h2 class="page-heading primary-color">Čo sa najnovšie odohralo?</h2>
  <% if selected_season.present? %>
    <% if @recent_matches.any? %>
      <div class="table-container default-color">
        <table>
          <thead>
          <tr>
            <th>Víťaz</th>
            <th>Výsledok</th>
            <th>Porazený</th>
          </tr>
          </thead>
          <tbody>
          <% @recent_matches.each.with_index do |match, idx| %>
            <tr>
              <td>
                <div class="fat-row">
                  <%= match.winner %>
                </div>
              </td>
              <td class="<%= 'border-white border-solid border-t-4' if idx > 0 %>">
                <div class="fat-row">
                  <%= link_to_match(match) do %>
                    <b><%= match.result %></b>
                    <% if match.date %>
                      <br><%= app_date match.date %>
                    <% end %>
                  <% end %>
                </div>
              </td>
              <td>
                <div class="fat-row">
                  <%= match.looser %>
                </div>
              </td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
      <p class="text-center pt-6 default-color">
        <%= link_to "Všetky zápasy", matches_path, class: "underline" %>
      </p>
    <% else %>
      <p class="p-8 text-center default-color">Žiadne zápasy sa v poslednej dobe nehrali.</p>
      <p class="p-2 text-center">
        <%= link_to "Zavolaj niekoho hrať!", rankings_path, class: "button button-red" %>
      </p>
    <% end %>
  <% else %>
    <p class="p-8 text-center default-color">Nič, pretože nie je sezóna. Čakáme kým začne.</p>
  <% end %>
  <div class="underline pt-6 default-color">
    <div class="py-1"><a href="#navbar">Hore</a></div>
    <div class="py-1"><a href="#planned-matches">Zápasy na pláne</a></div>
    <div class="py-1"><a href="#race">Nominácie PLAY OFF</a></div>
  </div>
</section>

<section id="planned-matches" class="base-salmon min-h-screen px-2 py-8 md:px-8">
  <h2 class="page-heading primary-color text-right">Zápasy, ktoré uvidíme.</h2>
  <% if selected_season.present? %>
    <% if @planned_matches.any? %>
      <div class="table-container">
        <table>
          <thead>
          <tr>
            <th>Vyzývateľ</th>
            <th>Vyzvaný</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <% @planned_matches.each.with_index do |match, idx| %>
            <tr>
              <td>
                <div class="fat-row">
                  <%= match.side 1 %>
                </div>
              </td>
              <td>
                <div class="fat-row">
                  <%= match.side 2 %>
                </div>
              </td>
              <td class="<%= 'border-white border-solid border-t-4' if idx > 0 %>">
                <div class="fat-row">
                  <% if match.play_date.present? %>
                    <%= link_to_match(match) do %>
                      <%= "#{app_date_span(match.play_date)}<br>#{match.play_time}<br>#{match.place&.name}".html_safe %>
                    <% end %>
                  <% else %>
                    <%= link_to_match(match) %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
      <p class="text-center pt-6">
        <%= link_to "Všetky zápasy", matches_path, class: "underline" %>
      </p>
    <% else %>
      <p class="p-8 text-center">Nikto neplánuje hrať zápas.</p>
      <p class="p-2 text-center">
        <a href="#" class="button button-red">
          Vyzvi niekoho!
        </a>
      </p>
    <% end %>

    <div id="players_open_to_play" class="text-center">
      <%= render partial: "shared/players_open_to_play",
                 locals: { players: @players_open_to_play } %>
    </div>

  <% else %>
    <p class="p-8 text-center">Zatiaľ neuvidíme žiadne, pretože nie je sezóna.</p>
  <% end %>
  <div class="underline pt-6">
    <div class="py-1"><a href="#navbar">Hore</a></div>
    <div class="py-1"><a href="#recent-matches">Posledné zápasy</a></div>
    <div class="py-1"><a href="#race">Nominácie PLAY OFF</a></div>
  </div>
</section>


<section id="race" class="base-red min-h-screen px-2 py-8 md:px-8">
  <h2 class="page-heading primary-color">Najväčší králi.</h2>
  <% if selected_season.present? %>
    <% if @top_rankings.any? %>

      <div class="table-container default-color">
        <table>
          <thead>
          <tr>
            <th></th>
            <th></th>
            <th>Body</th>
            <th>% výhier</th>
          </tr>
          </thead>
          <tbody>
          <% @top_rankings.each.with_index(1) do |ranking, position| %>
            <tr class="<%= ranking_row_css(selected_season, position) %>">
              <td class="<%= 'border-yellow-400 border-solid border-t-4' if position > 1 %>">
                <%= "#{position}." %>
              </td>
              <td><%= link_to ranking[:name], player_path(ranking[:id]), class: "underline" %></td>
              <td><%= ranking[:points] %></td>
              <td><%= "#{(ranking[:percentage] / 100.0).round(2)}%" %></td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
      <p class="p-2 text-center default-color lg:pt-4">
        Králi s bielou farbou sú aktuálne nominovaní na PLAY OFF.
        Tí šedí, to sú princovia, majú najväčšiu šancu sa do PLAY OFF dostať.
      </p>
      <p class="text-center default-color">
        <%= link_to "Celý rebríček", rankings_path, class: "py-3 px-4 underline" %>
      </p>
    <% else %>
      <p class="p-8 text-center default-color">V rebríčku nie je nikto.</p>
      <% if true # manager_signed_in? %>
        <p class="p-2 text-center">
          <a href="#" class="button button-red">
            Administrácia
          </a>
        </p>
      <% end %>
    <% end %>
  <% else %>
    <p class="p-8 text-center default-color">V rebríčku nie je nikto, pretože nie je sezóna.</p>
  <% end %>
  <div class="underline pt-6 default-color">
    <div class="py-1"><a href="#navbar">Hore</a></div>
    <div class="py-1"><a href="#recent-matches">Posledné zápasy</a></div>
    <div class="py-1"><a href="#planned-matches">Zápasy na pláne</a></div>
  </div>
</section>
